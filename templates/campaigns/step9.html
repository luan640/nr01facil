{% extends "base.html" %}
{% load static %}

{% block title %}{{ campaign.title }} | PLATAFORMA NR-1{% endblock %}

{% block extra_head %}
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}" />
  <style>
    .campaign-step {
      max-width: 980px;
      margin: 32px auto 60px;
      width: 100%;
      padding: 0 16px;
    }
    .campaign-step__header {
      text-align: center;
      display: grid;
      gap: 10px;
      margin-bottom: 16px;
    }
    .campaign-step__icon {
      width: 34px;
      height: 34px;
      margin: 0 auto;
      border-radius: 12px;
      background: #e6efff;
      color: #2563eb;
      display: grid;
      place-items: center;
      box-shadow: 0 8px 18px rgba(37, 99, 235, 0.18);
    }
    .campaign-step__title {
      margin: 0;
      font-size: clamp(1.55rem, 2vw + 1rem, 2.2rem);
      line-height: 1.2;
      font-weight: 800;
      letter-spacing: -0.02em;
    }
    .campaign-step__badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px 12px;
      border-radius: 999px;
      background: #dbeafe;
      color: #1d4ed8;
      font-weight: 700;
      font-size: 0.82rem;
      width: fit-content;
      margin: 0 auto;
    }
    .campaign-step__lead {
      margin: 0 auto;
      max-width: 620px;
      color: var(--slate-600);
      font-size: 0.98rem;
    }
    .campaign-step__progress {
      height: 10px;
      border-radius: 999px;
      background: #e2e8f0;
      border: 1px solid #cbd5e1;
      overflow: hidden;
      max-width: 560px;
      margin: 12px auto 0;
      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.08);
    }
    .campaign-step__progress span {
      display: block;
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #0f172a, #1e293b);
      border-radius: inherit;
    }
    .campaign-step__card {
      padding: 22px 22px 18px;
      max-width: 640px;
      margin: 0 auto;
    }
    .campaign-step__company {
      text-align: center;
      margin-bottom: 16px;
    }
    .campaign-step__company p {
      margin: 4px 0 0;
      color: var(--slate-600);
    }
    .comment-section {
      display: grid;
      gap: 8px;
      margin-bottom: 12px;
    }
    .comment-section__title {
      margin: 0;
      font-size: 1rem;
      font-weight: 800;
      color: #1d4ed8;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .comment-section__subtitle {
      margin: 0;
      color: #64748b;
      font-size: 0.88rem;
    }
    .comment-card {
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 12px 14px;
      background: #f8fbff;
      display: grid;
      gap: 10px;
    }
    .comment-card label {
      font-size: 0.88rem;
      font-weight: 700;
      color: #0f172a;
    }
    .comment-card textarea {
      width: 100%;
      min-height: 120px;
      resize: vertical;
      border: 1px solid #dbeafe;
      border-radius: 10px;
      padding: 10px 12px;
      font: inherit;
      background: #fff;
    }
    .comment-card__footer {
      display: flex;
      justify-content: flex-end;
      color: #94a3b8;
      font-size: 0.78rem;
    }
    .question-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
    }
    .btn--ghost {
      background: #fff;
      border: 1px solid #e2e8f0;
      color: #0f172a;
    }
    @media (max-width: 720px) {
      .campaign-step__card {
        padding: 18px 16px;
      }
    }
  </style>
{% endblock %}

{% block content %}
<main class="campaign-step">
  <header class="campaign-step__header">
    <div class="campaign-step__icon" aria-hidden="true">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
        <path d="M12 12c2.76 0 5-2.3 5-5.1C17 4.1 14.76 2 12 2S7 4.1 7 6.9C7 9.7 9.24 12 12 12Z" stroke="currentColor" stroke-width="1.6" />
        <path d="M4 21c0-4.2 3.6-7.6 8-7.6s8 3.4 8 7.6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
      </svg>
    </div>
    <h1 class="campaign-step__title">Ferramenta de Indicador de Estresse</h1>
    <div class="campaign-step__badge">Etapa 9 de 10</div>
    <p class="campaign-step__lead">
      Este questionário é totalmente anônimo e contém perguntas sobre suas condições de trabalho.
      Sua opinião é essencial para melhorar o ambiente de trabalho.
    </p>
    <div class="campaign-step__progress" role="presentation" style="height: 10px; background: #e2e8f0; border: 1px solid #cbd5e1;">
      <span style="display: block; height: 100%; width: 90%; background: #0f172a;"></span>
    </div>
  </header>

  <section class="card campaign-step__card">
    <div class="campaign-step__company">
      <strong>{{ company.name }}</strong>
      <p>CNPJ: {{ company.cnpj|default:"-" }}</p>
    </div>

    <div class="comment-section">
      <h2 class="comment-section__title">
        <span aria-hidden="true">*</span> {{ section_title|default:"Comentários Adicionais" }}
      </h2>
      <p class="comment-section__subtitle">
        {{ section_description|default:"Gostaria de compartilhar algum comentário adicional sobre sua experiência de trabalho?" }}
      </p>
    </div>

    <form id="step-form" method="post" action="{% url 'campaigns-access' campaign.uuid %}" data-campaign-uuid="{{ campaign.uuid }}" data-step="9" data-final-step="1">
      {% csrf_token %}
      <input type="hidden" name="step" value="9" />
      <div class="comment-card">
        <label for="comments">Seus comentários (opcional)</label>
        <textarea id="comments" name="comments" maxlength="1000" placeholder="Compartilhe suas observações, sugestões ou qualquer comentário que considere importante sobre sua experiência de trabalho...">{{ saved_comment|default:"" }}</textarea>
        <div class="comment-card__footer">0/1000 caracteres</div>
      </div>

      <div class="question-actions">
        <a class="btn btn--ghost" href="{% url 'campaigns-access' campaign.uuid %}?step=8">← Voltar</a>
        <button class="btn btn--primary" type="submit">Finalizar Avaliação →</button>
      </div>
    </form>
  </section>
</main>
{% endblock %}

{% block extra_scripts %}
  <script src="{% static 'js/campaign_localstorage.js' %}"></script>
  <script>
    (function () {
      const textarea = document.getElementById('comments');
      const counter = document.querySelector('.comment-card__footer');
      if (textarea && counter) {
        const updateCounter = () => {
          const length = textarea.value.length;
          counter.textContent = length + '/1000 caracteres';
        };
        textarea.addEventListener('input', updateCounter);
        updateCounter();
      }
    })();
  </script>
{% endblock %}
