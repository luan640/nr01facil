{% extends "base.html" %}
{% load static %}

{% block title %}{{ campaign.title }} | PLATAFORMA NR-1{% endblock %}

{% block extra_head %}
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'css/campaign.css' %}" />
{% endblock %}

{% block content %}
<div class="cpg-page">
  <div class="cpg-topbar">
    <span class="cpg-topbar__brand">{{ campaign.title }}</span>
    <div class="cpg-topbar__track">
      <div class="cpg-topbar__fill" style="width:40%"></div>
    </div>
    <span class="cpg-topbar__step">4 / 10</span>
  </div>

  <main class="campaign-step">
    <header class="cpg-header">
      <div class="cpg-header__badge">Etapa 4 de 10</div>
      <h1 class="cpg-header__title">Ferramenta de Indicador de Estresse</h1>
      <p class="cpg-header__sub">Este question√°rio √© totalmente an√¥nimo e cont√©m perguntas sobre suas condi√ß√µes de trabalho. Sua opini√£o √© essencial para melhorar o ambiente de trabalho.</p>
    </header>

    <section class="campaign-step__card">
      <div class="campaign-step__company">
        <strong>{{ company.name }}</strong>
        <p>CNPJ: {{ company.cnpj|default:"-" }}</p>
      </div>

      <div class="question-section">
        <h2 class="question-section__title">
          <span aria-hidden="true">üìä</span> {{ section_title|default:"Demandas" }}
        </h2>
        <p class="question-section__subtitle">
          {{ section_description|default:"Carga de trabalho, ritmos de tarefa e exig√™ncias cognitivas." }}
        </p>
      </div>

      <form id="step-form" method="post" action="{% url 'campaigns-access' campaign.uuid %}" data-campaign-uuid="{{ campaign.uuid }}" data-step="4">
        {% csrf_token %}
        <input type="hidden" name="step" value="4" />
        {% if question_items %}
          {% for question in question_items %}
          <div class="question-card">
            <div class="question-card__title-row">
              <p class="question-card__title">{{ forloop.counter }}. {{ question.text }}</p>
              <span class="question-card__hint" aria-hidden="true">i</span>
            </div>
            <div class="question-card__options">
              {% for option in scale_options %}
                <label class="question-option">
                  <input type="radio" name="q{{ forloop.parentloop.counter }}" value="{{ option }}" {% if question.answer == option %}checked{% endif %} />
                  <span>{{ option }}</span>
                </label>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
        {% else %}
          {% for question in questions %}
            <div class="question-card">
              <div class="question-card__title-row">
                <p class="question-card__title">{{ forloop.counter }}. {{ question }}</p>
                <span class="question-card__hint" aria-hidden="true">i</span>
              </div>
              <div class="question-card__options">
                {% for option in scale_options %}
                  <label class="question-option">
                    <input type="radio" name="q{{ forloop.parentloop.counter }}" value="{{ option }}" />
                    <span>{{ option }}</span>
                  </label>
                {% endfor %}
              </div>
            </div>
          {% endfor %}
        {% endif %}

        <div class="question-actions">
          <a class="btn btn--ghost" href="{% url 'campaigns-access' campaign.uuid %}?step=3">‚Üê Voltar</a>
          <button class="btn btn--primary" type="submit" data-next-step>Pr√≥xima ‚Üí</button>
        </div>
      </form>
    </section>
  </main>
</div>
{% endblock %}

{% block extra_scripts %}
  <script src="{% static 'js/campaign_localstorage.js' %}"></script>
{% endblock %}
