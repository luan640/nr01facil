<div id="companies-table-container" data-table-container>
  {% if messages %}
    <section class="stack-gap">
      {% for message in messages %}
        <div class="notice{% if message.tags %} notice--{{ message.tags }}{% endif %}">{{ message }}</div>
      {% endfor %}
    </section>
  {% endif %}

  <section class="company-cards">
    {% for company in companies %}
      <article class="company-card" data-company-card-id="{{ company.id }}">
        <div class="company-card__header">
          <div class="company-card__logo">
            {% if company.logo %}
              <img src="{{ company.logo.url }}" alt="Logo da empresa" />
            {% else %}
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M6 3h12l3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3Zm0 2a1 1 0 0 0-1 1v10.5l3.5-3.5 3 3 4.5-4.5L20 16V6a1 1 0 0 0-1-1H6Zm2.5 2.5a1.5 1.5 0 1 1 0 3.001 1.5 1.5 0 0 1 0-3.001Z" fill="currentColor"/>
                <path d="M7 19l4-4 3 3 4-4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            {% endif %}
          </div>
          <div class="company-card__title">
            <strong>{{ company.name }}</strong>
            <small>{{ company.legal_name|default:"-" }}</small>
          </div>
          <span class="status-badge {% if company.is_active %}status-badge--active{% else %}status-badge--paused{% endif %}">
            {% if company.is_active %}Ativa{% else %}Inativa{% endif %}
          </span>
        </div>
        <div class="company-card__meta">
          <div>
            {% with digits=company.cnpj|default:"" %}
              {% if digits|length == 11 %}
                <span class="company-card__label">CPF</span>
              {% else %}
                <span class="company-card__label">CNPJ</span>
              {% endif %}
            {% endwith %}
            <span>{{ company.cnpj|default:"-" }}</span>
          </div>
          <div>
            <span class="company-card__label">Cidade/UF</span>
            <span>
              {% if company.address_city %}
                {{ company.address_city }}{% if company.address_state %}/{{ company.address_state }}{% endif %}
              {% else %}
                -
              {% endif %}
            </span>
          </div>
          <div>
            <span class="company-card__label">Funcionarios</span>
            <span>{{ company.employee_count|default:"0" }}</span>
          </div>
        </div>
        <div class="company-card__actions">
          <form method="post" action="{% url 'company-select' %}">
            {% csrf_token %}
            <input type="hidden" name="company_id" value="{{ company.id }}" />
            <input type="hidden" name="next_url" value="{% url 'dashboard' %}" />
            <button class="icon-btn" type="submit" title="Acessar" aria-label="Acessar" data-loading-text="Acessando...">
              <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 4.5c5 0 9 3.5 10 7.5-1 4-5 7.5-10 7.5S3 16 2 12c1-4 5-7.5 10-7.5Zm0 3a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9Zm0 2.2a2.3 2.3 0 1 1 0 4.6 2.3 2.3 0 0 1 0-4.6Z" fill="currentColor"/></svg>
            </button>
          </form>
          <button
            class="icon-btn"
            type="button"
            title="Editar"
            aria-label="Editar"
            data-open-edit-company
            data-update-url="{% url 'companies-update' company.id %}"
            data-name="{{ company.name }}"
            data-legal-name="{{ company.legal_name }}"
            data-legal-representative-name="{{ company.legal_representative_name }}"
            data-cnpj="{{ company.cnpj }}"
            data-employee-count="{{ company.employee_count }}"
            data-max-users="{{ company.max_users }}"
            data-max-totems="{{ company.max_totems }}"
            data-address-street="{{ company.address_street }}"
            data-address-number="{{ company.address_number }}"
            data-address-complement="{{ company.address_complement }}"
            data-address-neighborhood="{{ company.address_neighborhood }}"
            data-address-city="{{ company.address_city }}"
            data-address-state="{{ company.address_state }}"
            data-address-zipcode="{{ company.address_zipcode }}"
            data-responsible-email="{{ company.responsible_email }}"
            data-assessment-type="{{ company.assessment_type }}"
            data-cnae="{{ company.cnae }}"
            data-risk-level="{{ company.risk_level }}"
            data-unit-type="{{ company.unit_type }}"
            data-unit-name="{{ company.unit_name }}"
            data-is-active="{% if company.is_active %}1{% else %}0{% endif %}"
          >
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 17.25V20h2.75l8.11-8.11-2.75-2.75L4 17.25Zm13.71-8.04a1 1 0 0 0 0-1.42l-1.5-1.5a1 1 0 0 0-1.42 0l-1.17 1.17 2.75 2.75 1.34-1.3Z" fill="currentColor"/></svg>
          </button>
          <form method="post" action="{% url 'companies-delete' company.id %}" data-company-id="{{ company.id }}" data-platform-confirm="{% if company.is_active %}Desativar{% else %}Ativar{% endif %} esta empresa?">
            {% csrf_token %}
            <button class="icon-btn" type="submit" title="{% if company.is_active %}Desativar{% else %}Ativar{% endif %}" aria-label="{% if company.is_active %}Desativar{% else %}Ativar{% endif %}">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2Zm-5 9h10v2H7v-2Z" fill="currentColor"/></svg>
            </button>
          </form>
        </div>
      </article>
    {% empty %}
      <div class="company-card company-card--empty">
        Nenhuma empresa cadastrada.
      </div>
    {% endfor %}
  </section>
  {% include "partials/_table_pagination.html" %}
</div>
