{% extends "base.html" %}
{% load static %}

{% block title %}Empresas | PLATAFORMA NR-1{% endblock %}

{% block extra_head %}
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}" />
{% endblock %}

{% block content %}
<div class="app-layout">
  {% include "partials/sidebar.html" with active_menu="companies" is_master=True %}

  <main class="content" data-page="companies">
    <header class="content__header">
      <div>
        <h1 class="content__title">Empresas</h1>
        <p class="content__subtitle">Gerencie as empresas cadastradas na plataforma.</p>
      </div>
      <button class="btn btn--primary" type="button" data-open-modal="create-company-modal">Nova empresa</button>
    </header>

    <section class="card card--full table-filters-card">
      <p class="card__label">Filtros</p>
      <form method="get" action="{% url 'companies-list' %}" class="period-filter table-filters-form" data-ajax-table-form data-table-container-id="companies-table-container">
        <div class="filter-field">
          <label for="companies_name">Nome</label>
          <select id="companies_name" name="name">
            <option value="">Todas</option>
            {% for company in companies_filter_options %}
              <option value="{{ company.name }}"{% if search_name == company.name %} selected{% endif %}>{{ company.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="filter-field">
          <label for="companies_status">Status</label>
          <select id="companies_status" name="status">
            <option value="">Todos</option>
            <option value="active"{% if selected_status == 'active' %} selected{% endif %}>Ativa</option>
            <option value="inactive"{% if selected_status == 'inactive' %} selected{% endif %}>Inativa</option>
          </select>
        </div>
        <button class="btn btn--primary" type="submit">Filtrar</button>
        <a class="btn btn--light" href="{% url 'companies-list' %}">Limpar</a>
      </form>
    </section>

    {% include "companies/_table_container.html" %}

    <div class="modal-backdrop" data-modal="create-company-modal" aria-hidden="true">
      <div class="modal-card modal-card--lg modal-card--wizard">
        <div class="modal-card__header">
          <h2>Cadastrar empresa</h2>
          <button type="button" class="modal-close" data-close-modal>&times;</button>
        </div>
        <form method="post" action="{% url 'companies-create' %}" class="form-grid modal-form" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="company-wizard" data-company-wizard>
            <div class="company-wizard__progress">
              <span class="company-wizard__step is-active" data-step-indicator="1">1</span>
              <span class="company-wizard__line"></span>
              <span class="company-wizard__step" data-step-indicator="2">2</span>
              <span class="company-wizard__line"></span>
              <span class="company-wizard__step" data-step-indicator="3">3</span>
            </div>

            <section class="company-wizard__panel is-active" data-step="1">
              <div class="company-wizard__intro">
                <h3>Cadastrar Nova Empresa</h3>
                <p>Preencha os dados para cadastrar uma nova empresa no sistema.</p>
              </div>
              <p class="company-wizard__question">1. Para comecar, selecione o tipo de documento</p>
              <div class="company-wizard__options">
                <label class="company-wizard__option">
                  <input type="radio" name="document_type" value="cnpj" checked />
                  <span class="company-wizard__option-card">
                    <span class="company-wizard__option-title">CNPJ</span>
                    <span class="company-wizard__option-subtitle">Pessoa juridica</span>
                  </span>
                </label>
                <label class="company-wizard__option">
                  <input type="radio" name="document_type" value="cpf" />
                  <span class="company-wizard__option-card">
                    <span class="company-wizard__option-title">CPF</span>
                    <span class="company-wizard__option-subtitle">Pessoa fisica</span>
                  </span>
                </label>
              </div>
              <div class="company-wizard__actions">
                <button class="btn btn--primary" type="button" data-company-step-next>Proximo</button>
              </div>
            </section>

            <section class="company-wizard__panel" data-step="2">
              <p class="company-wizard__question">2. Selecione o tipo de unidade</p>
              <div class="company-wizard__options company-wizard__options--grid-2">
                <label class="company-wizard__option">
                  <input type="radio" name="unit_type" value="matriz" checked />
                  <span class="company-wizard__option-card">
                    <span class="company-wizard__option-title">Matriz</span>
                    <span class="company-wizard__option-subtitle">Sede principal da empresa</span>
                  </span>
                </label>
                <label class="company-wizard__option">
                  <input type="radio" name="unit_type" value="filial" />
                  <span class="company-wizard__option-card">
                    <span class="company-wizard__option-title">Filial</span>
                    <span class="company-wizard__option-subtitle">Unidade secundaria</span>
                  </span>
                </label>
                <label class="company-wizard__option">
                  <input type="radio" name="unit_type" value="unidade" />
                  <span class="company-wizard__option-card">
                    <span class="company-wizard__option-title">Unidade</span>
                    <span class="company-wizard__option-subtitle">Unidade operacional</span>
                  </span>
                </label>
                <label class="company-wizard__option">
                  <input type="radio" name="unit_type" value="outro" />
                  <span class="company-wizard__option-card">
                    <span class="company-wizard__option-title">Outro</span>
                    <span class="company-wizard__option-subtitle">Tipo personalizado</span>
                  </span>
                </label>
              </div>
              <div class="company-wizard__unit-name" data-unit-name>
                <label for="create_company_unit_name">Nome da unidade (opcional)</label>
                <input id="create_company_unit_name" name="unit_name" maxlength="255" />
              </div>
              <div class="company-wizard__actions">
                <button class="btn btn--light" type="button" data-company-step-prev>Voltar</button>
                <button class="btn btn--primary" type="button" data-company-step-next>Proximo</button>
              </div>
            </section>

            <section class="company-wizard__panel" data-step="3">
              <div class="company-wizard__intro" style="grid-column: 1 / -1;">
                <h3>3. Preencha os dados da empresa</h3>
                <p>Preencha os dados para cadastrar uma nova empresa no sistema.</p>
              </div>
              <div class="form-field">
                <label for="create_company_name">Nome da Empresa</label>
                <input id="create_company_name" name="name" required maxlength="255" placeholder="Nome da empresa" />
              </div>
              <div class="form-field">
                <label for="create_company_cnpj" data-document-label>CNPJ</label>
                <input id="create_company_cnpj" name="cnpj" required maxlength="18" placeholder="00.000.000/0000-00" />
              </div>
              <div class="form-field">
                <label for="create_company_legal_representative">Nome do Responsavel</label>
                <input id="create_company_legal_representative" name="legal_representative_name" required maxlength="255" placeholder="Nome completo" />
              </div>
              <div class="form-field">
                <label for="create_company_responsible_email">E-mail do Responsavel</label>
                <input id="create_company_responsible_email" name="responsible_email" type="email" maxlength="255" placeholder="email@empresa.com" />
              </div>
              <div class="form-field">
                <label for="create_company_assessment_type">Tipo de Avaliacao</label>
                <select id="create_company_assessment_type" name="assessment_type">
                  <option value="setor">Setor</option>
                  <option value="ghe">GHE</option>
                </select>
              </div>
              <div class="form-field">
                <label for="create_company_cnae">CNAE do estabelecimento</label>
                <input id="create_company_cnae" name="cnae" maxlength="20" placeholder="Ex: 5510-8/01" />
              </div>
              <div class="form-field">
                <label for="create_company_risk_level">Grau de risco</label>
                <select id="create_company_risk_level" name="risk_level">
                  <option value="1">Grau 1</option>
                  <option value="2">Grau 2</option>
                  <option value="3">Grau 3</option>
                  <option value="4">Grau 4</option>
                </select>
              </div>
              <div class="form-field">
                <label for="create_company_employee_count">Numero de funcionarios</label>
                <input id="create_company_employee_count" name="employee_count" type="number" min="0" placeholder="Numero de funcionarios" />
              </div>

              <div class="form-field" style="grid-column: 1 / -1;">
                <p class="card__label">Endereco</p>
              </div>
              <div class="form-field">
                <label for="create_company_address_street">Logradouro</label>
                <input id="create_company_address_street" name="address_street" maxlength="255" />
              </div>
              <div class="form-field">
                <label for="create_company_address_number">Numero</label>
                <input id="create_company_address_number" name="address_number" maxlength="40" />
              </div>
              <div class="form-field">
                <label for="create_company_address_complement">Complemento</label>
                <input id="create_company_address_complement" name="address_complement" maxlength="120" />
              </div>
              <div class="form-field">
                <label for="create_company_address_neighborhood">Bairro</label>
                <input id="create_company_address_neighborhood" name="address_neighborhood" maxlength="120" />
              </div>
              <div class="form-field">
                <label for="create_company_address_city">Cidade</label>
                <input id="create_company_address_city" name="address_city" maxlength="120" />
              </div>
              <div class="form-field">
                <label for="create_company_address_state">UF</label>
                <input id="create_company_address_state" name="address_state" maxlength="2" />
              </div>
              <div class="form-field">
                <label for="create_company_address_zipcode">CEP</label>
                <input id="create_company_address_zipcode" name="address_zipcode" maxlength="10" />
              </div>
              <div class="form-field">
                <label for="create_company_logo">Logo</label>
                <input id="create_company_logo" name="logo" type="file" accept="image/*" />
              </div>
              <div class="form-actions">
                <button class="btn btn--light" type="button" data-company-step-prev>Voltar</button>
                <button class="btn btn--primary" type="submit">Salvar</button>
                <button class="btn btn--light" type="button" data-close-modal>Cancelar</button>
              </div>
            </section>
          </div>
        </form>
      </div>
    </div>

    <div class="modal-backdrop" data-modal="edit-company-modal" aria-hidden="true">
      <div class="modal-card modal-card--lg modal-card--wizard">
        <div class="modal-card__header">
          <h2>Editar empresa</h2>
          <button type="button" class="modal-close" data-close-modal>&times;</button>
        </div>
        <form method="post" action="" class="form-grid modal-form" data-edit-company-form enctype="multipart/form-data">
          {% csrf_token %}
          <div class="company-wizard" data-company-wizard>
            <div class="company-wizard__progress">
              <span class="company-wizard__step is-active" data-step-indicator="1">1</span>
              <span class="company-wizard__line"></span>
              <span class="company-wizard__step" data-step-indicator="2">2</span>
              <span class="company-wizard__line"></span>
              <span class="company-wizard__step" data-step-indicator="3">3</span>
            </div>

            <section class="company-wizard__panel is-active" data-step="1">
              <div class="company-wizard__intro">
                <h3>Editar Empresa</h3>
                <p>Atualize as informacoes da empresa.</p>
              </div>
              <p class="company-wizard__question">1. Para comecar, selecione o tipo de documento</p>
              <div class="company-wizard__options">
                <label class="company-wizard__option">
                  <input type="radio" name="document_type" value="cnpj" checked />
                  <span class="company-wizard__option-card">
                    <span class="company-wizard__option-title">CNPJ</span>
                    <span class="company-wizard__option-subtitle">Pessoa juridica</span>
                  </span>
                </label>
                <label class="company-wizard__option">
                  <input type="radio" name="document_type" value="cpf" />
                  <span class="company-wizard__option-card">
                    <span class="company-wizard__option-title">CPF</span>
                    <span class="company-wizard__option-subtitle">Pessoa fisica</span>
                  </span>
                </label>
              </div>
              <div class="company-wizard__actions">
                <button class="btn btn--primary" type="button" data-company-step-next>Proximo</button>
              </div>
            </section>

            <section class="company-wizard__panel" data-step="2">
              <p class="company-wizard__question">2. Selecione o tipo de unidade</p>
              <div class="company-wizard__options company-wizard__options--grid-2">
                <label class="company-wizard__option">
                  <input type="radio" name="unit_type" value="matriz" checked />
                  <span class="company-wizard__option-card">
                    <span class="company-wizard__option-title">Matriz</span>
                    <span class="company-wizard__option-subtitle">Sede principal da empresa</span>
                  </span>
                </label>
                <label class="company-wizard__option">
                  <input type="radio" name="unit_type" value="filial" />
                  <span class="company-wizard__option-card">
                    <span class="company-wizard__option-title">Filial</span>
                    <span class="company-wizard__option-subtitle">Unidade secundaria</span>
                  </span>
                </label>
                <label class="company-wizard__option">
                  <input type="radio" name="unit_type" value="unidade" />
                  <span class="company-wizard__option-card">
                    <span class="company-wizard__option-title">Unidade</span>
                    <span class="company-wizard__option-subtitle">Unidade operacional</span>
                  </span>
                </label>
                <label class="company-wizard__option">
                  <input type="radio" name="unit_type" value="outro" />
                  <span class="company-wizard__option-card">
                    <span class="company-wizard__option-title">Outro</span>
                    <span class="company-wizard__option-subtitle">Tipo personalizado</span>
                  </span>
                </label>
              </div>
              <div class="company-wizard__unit-name" data-unit-name>
                <label for="edit_company_unit_name">Nome da unidade (opcional)</label>
                <input id="edit_company_unit_name" name="unit_name" maxlength="255" />
              </div>
              <div class="company-wizard__actions">
                <button class="btn btn--light" type="button" data-company-step-prev>Voltar</button>
                <button class="btn btn--primary" type="button" data-company-step-next>Proximo</button>
              </div>
            </section>

            <section class="company-wizard__panel" data-step="3">
              <div class="company-wizard__intro" style="grid-column: 1 / -1;">
                <h3>3. Preencha os dados da empresa</h3>
                <p>Atualize os dados da empresa.</p>
              </div>
              <div class="form-field">
                <label for="edit_company_name">Nome da Empresa</label>
                <input id="edit_company_name" name="name" required maxlength="255" placeholder="Nome da empresa" />
              </div>
              <div class="form-field">
                <label for="edit_company_cnpj" data-document-label>CNPJ</label>
                <input id="edit_company_cnpj" name="cnpj" required maxlength="18" placeholder="00.000.000/0000-00" />
              </div>
              <div class="form-field">
                <label for="edit_company_legal_representative">Nome do Responsavel</label>
                <input id="edit_company_legal_representative" name="legal_representative_name" required maxlength="255" placeholder="Nome completo" />
              </div>
              <div class="form-field">
                <label for="edit_company_responsible_email">E-mail do Responsavel</label>
                <input id="edit_company_responsible_email" name="responsible_email" type="email" maxlength="255" placeholder="email@empresa.com" />
              </div>
              <div class="form-field">
                <label for="edit_company_assessment_type">Tipo de Avaliacao</label>
                <select id="edit_company_assessment_type" name="assessment_type">
                  <option value="setor">Setor</option>
                  <option value="ghe">GHE</option>
                </select>
              </div>
              <div class="form-field">
                <label for="edit_company_cnae">CNAE do estabelecimento</label>
                <input id="edit_company_cnae" name="cnae" maxlength="20" placeholder="Ex: 5510-8/01" />
              </div>
              <div class="form-field">
                <label for="edit_company_risk_level">Grau de risco</label>
                <select id="edit_company_risk_level" name="risk_level">
                  <option value="1">Grau 1</option>
                  <option value="2">Grau 2</option>
                  <option value="3">Grau 3</option>
                  <option value="4">Grau 4</option>
                </select>
              </div>
              <div class="form-field">
                <label for="edit_company_employee_count">Numero de funcionarios</label>
                <input id="edit_company_employee_count" name="employee_count" type="number" min="0" placeholder="Numero de funcionarios" />
              </div>

              <div class="form-field" style="grid-column: 1 / -1;">
                <p class="card__label">Endereco</p>
              </div>
              <div class="form-field">
                <label for="edit_company_address_street">Logradouro</label>
                <input id="edit_company_address_street" name="address_street" maxlength="255" />
              </div>
              <div class="form-field">
                <label for="edit_company_address_number">Numero</label>
                <input id="edit_company_address_number" name="address_number" maxlength="40" />
              </div>
              <div class="form-field">
                <label for="edit_company_address_complement">Complemento</label>
                <input id="edit_company_address_complement" name="address_complement" maxlength="120" />
              </div>
              <div class="form-field">
                <label for="edit_company_address_neighborhood">Bairro</label>
                <input id="edit_company_address_neighborhood" name="address_neighborhood" maxlength="120" />
              </div>
              <div class="form-field">
                <label for="edit_company_address_city">Cidade</label>
                <input id="edit_company_address_city" name="address_city" maxlength="120" />
              </div>
              <div class="form-field">
                <label for="edit_company_address_state">UF</label>
                <input id="edit_company_address_state" name="address_state" maxlength="2" />
              </div>
              <div class="form-field">
                <label for="edit_company_address_zipcode">CEP</label>
                <input id="edit_company_address_zipcode" name="address_zipcode" maxlength="10" />
              </div>
              <div class="form-field">
                <label for="edit_company_logo">Logo</label>
                <input id="edit_company_logo" name="logo" type="file" accept="image/*" />
              </div>
              <div class="form-actions">
                <button class="btn btn--light" type="button" data-company-step-prev>Voltar</button>
                <button class="btn btn--primary" type="submit">Salvar</button>
                <button class="btn btn--light" type="button" data-close-modal>Cancelar</button>
              </div>
            </section>
          </div>
        </form>
      </div>
    </div>
</div>
  </main>
</div>
{% endblock %}

{% block extra_scripts %}
  <script src="{% static 'js/dashboard_sidebar.js' %}"></script>
  <script src="{% static 'js/companies_modals.js' %}"></script>
  <script src="{% static 'js/table_async.js' %}"></script>
{% endblock %}
